<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
  <script>

    const options = {
      method: 'GET',
      headers: {
        accept: 'application/json',
        Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI3MjY5MDEwOTNkNDQzM2EyNGFiZTRkMjdiMmM0YTRkMyIsInN1YiI6IjY0NzE5OTI1OTQwOGVjMDExZjJiNDZkOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.EUGvXNsr4R7VmKWXg8f_-xDsn9NyQOmaoBv-NryWFsc'
      }
    };

    const listing = () => {
      fetch('https://api.themoviedb.org/3/movie/top_rated?language=en-US&page=1', options)
        .then(response => response.json())
        .then(response => {
          response["results"].forEach((i) => {

            let title = i['title']
            let rate = i['vote_average']
            let desc = i['overview']
            let img = i['poster_path']
            let id = i['id']
            let url = `https://image.tmdb.org/t/p/w500/${img}`

            let temp_html = ` <img class="poster" src="${url}" alt="movie">
                            <h3 style=" text-align: center; text-decoration: underline;">${title}</h3>
                            <p>${desc}
                            </p>
                            <footer class="rate"><p>Ration : ${rate}</p></footer>
                          `
            // cardList 하위로 card 요소들 붙여넣기
            const $cardList = document.getElementById('card-list')
            const $card = document.createElement("div")
            $card.classList.add("card")
            $card.innerHTML = temp_html
            $cardList.appendChild($card)

            // click 이벤트 적용
            $card.addEventListener('click', () => {
              alert(`영화 id : ${id}`);
            });
          })
        })
        .then(response => {
          // 검색기능 구현
          const $form = document.querySelector(".search-form");
          $form.addEventListener('submit', onclickSearch);
        })
        .catch(err => console.error(err));
    }
    listing()



    const onclickSearch = (e) => {
      e.preventDefault();
      const $value = document.getElementById("text").value;
      if (!$value) listing()
      else {
        fetch('https://api.themoviedb.org/3/movie/top_rated?language=en-US&page=1', options)
          .then(response => response.json())
          .then(response => {
            let sortList = response["results"].filter(i => {
              return i['title'].toLowerCase().includes($value);
            })
            console.log(sortList);

            const $cardList = document.getElementById('card-list')
            const $card = document.getElementById('card')

            // $cardList.removeChild($card)
            sortList.forEach((i) => {

              let title = i['title']
              let rate = i['vote_average']
              let desc = i['overview']
              let img = i['poster_path']
              let id = i['id']
              let url = `https://image.tmdb.org/t/p/w500/${img}`

              let temp_html = ` <img class="poster" src="${url}" alt="movie">
                            <h3 style=" text-align: center; text-decoration: underline;">${title}</h3>
                            <p>${desc}
                            </p>
                            <footer class="rate"><p>Ration : ${rate}</p></footer>
                          `
              // cardList 하위로 card 요소들 붙여넣기
              const $cardList = document.getElementById('card-list')
              const $card = document.createElement("div")
              $card.classList.add("card")
              $card.innerHTML = temp_html
              $cardList.appendChild($card)

              // click 이벤트 적용
              $card.addEventListener('click', () => {
                alert(`영화 id : ${id}`);
              });
            })
          })
      }
    }

  </script>
</head>

<body>
  <!-- header -->
  <header>
    <h1 class="header_title" style="  color: #fff;">Movie Collection</h1>
  </header>
  <!-- 검색기능 -->
  <form class="search-form">
    <input id="text" type="text" />
    <button type="submit" class="btn">검색</button>
  </form>
  <!-- 카드 섹션 -->
  <section>
    <div class="card-list" id="card-list">
    </div>
  </section>

</body>

</html>